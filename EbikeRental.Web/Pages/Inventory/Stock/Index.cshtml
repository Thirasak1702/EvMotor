@page
@model EbikeRental.Web.Pages.Inventory.Stock.IndexModel
@{
    ViewData["Title"] = "Stock Overview";
}

<div class="flex justify-between items-center mb-6">
    <h2 class="text-2xl font-bold text-gray-800">
        <i class="bi bi-boxes mr-2"></i>Stock Overview
    </h2>
</div>

<!-- Filters -->
<div class="bg-white rounded-lg shadow-sm mb-4">
    <div class="bg-gray-50 px-6 py-4 border-b border-gray-200 rounded-t-lg">
        <h5 class="text-lg font-semibold text-gray-800 mb-0">
            <i class="bi bi-funnel mr-2"></i>Filters
        </h5>
    </div>
    <div class="p-6">
        <form method="get">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Item (Code or Name)</label>
                    <input type="text"
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                           name="itemFilter" value="@Model.ItemFilter" placeholder="Search item..." />
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Warehouse</label>
                    <select class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                            name="warehouseFilter">
                        <option value="">All Warehouses</option>
                        @foreach (var wh in Model.Warehouses)
                        {
                            <option value="@wh.Id" selected="@(Model.WarehouseFilter == wh.Id)">@wh.Code - @wh.Name</option>
                        }
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Stock Status</label>
                    <select class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                            name="stockStatus">
                        <option value="">All</option>
                        <option value="InStock" selected="@(Model.StockStatus == "InStock")">In Stock</option>
                        <option value="OutOfStock" selected="@(Model.StockStatus == "OutOfStock")">Out of Stock</option>
                        <option value="LowStock" selected="@(Model.StockStatus == "LowStock")">Low Stock (&lt; 10)</option>
                    </select>
                </div>
            </div>

            <div class="flex gap-2 mt-4">
                <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg transition inline-flex items-center">
                    <i class="bi bi-search mr-2"></i> Search
                </button>
                <a asp-page="Index" class="bg-gray-500 hover:bg-gray-600 text-white font-medium px-4 py-2 rounded-lg transition inline-flex items-center">
                    <i class="bi bi-x-circle mr-2"></i> Clear
                </a>
            </div>
        </form>
    </div>
</div>

<!-- Stock Table -->
<div class="bg-white rounded-lg shadow-sm">
    <div class="p-6">
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="bg-gray-50 border-b border-gray-200">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Item Code</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Item Name</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Warehouse</th>
                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-700 uppercase tracking-wider">On Hand</th>
                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-700 uppercase tracking-wider">Reserved</th>
                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-700 uppercase tracking-wider">Available</th>
                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-700 uppercase tracking-wider">Avg Cost</th>
                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-700 uppercase tracking-wider">Total Value</th>
                        <th class="px-6 py-3 text-center text-xs font-medium text-gray-700 uppercase tracking-wider">Batch/Serial</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-200">
                    @if (Model.StockBalances.Any())
                    {
                        @foreach (var stock in Model.StockBalances)
                        {
                            <tr class="hover:bg-gray-50 transition">
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <strong class="text-gray-900">@stock.Item?.Code</strong>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-gray-700">@stock.Item?.Name</td>
                                <td class="px-6 py-4 whitespace-nowrap text-gray-700">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                        @stock.Warehouse?.Code
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-right">
                                    <span class="@(stock.QuantityOnHand > 0 ? "text-gray-900 font-semibold" : "text-red-600")">
                                        @stock.QuantityOnHand.ToString("N2")
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-right text-gray-700">
                                    @stock.QuantityReserved.ToString("N2")
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-right">
                                    <span class="@(stock.QuantityAvailable > 0 ? "text-green-600 font-semibold" : stock.QuantityAvailable < 0 ? "text-red-600" : "text-gray-500")">
                                        @stock.QuantityAvailable.ToString("N2")
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-right text-gray-700">
                                    @stock.AverageCost.ToString("N2")
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-right">
                                    <strong class="text-gray-900">@stock.TotalValue.ToString("N2")</strong>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-center text-xs text-gray-600">
                                    @if (!string.IsNullOrEmpty(stock.BatchNumber))
                                    {
                                        <div class="inline-flex items-center px-2 py-1 rounded-md bg-purple-100 text-purple-800">
                                            <i class="bi bi-tag mr-1"></i>@stock.BatchNumber
                                        </div>
                                    }
                                    @if (!string.IsNullOrEmpty(stock.SerialNumber))
                                    {
                                        <div class="inline-flex items-center px-2 py-1 rounded-md bg-indigo-100 text-indigo-800 mt-1">
                                            <i class="bi bi-upc-scan mr-1"></i>@stock.SerialNumber
                                        </div>
                                    }
                                    @if (string.IsNullOrEmpty(stock.BatchNumber) && string.IsNullOrEmpty(stock.SerialNumber))
                                    {
                                        <span class="text-gray-400">-</span>
                                    }
                                </td>
                            </tr>
                        }
                        <tr class="bg-gray-50 font-semibold">
                            <td colspan="3" class="px-6 py-4 text-right text-gray-900">Total:</td>
                            <td class="px-6 py-4 text-right text-gray-900">@Model.StockBalances.Sum(s => s.QuantityOnHand).ToString("N2")</td>
                            <td class="px-6 py-4 text-right text-gray-900">@Model.StockBalances.Sum(s => s.QuantityReserved).ToString("N2")</td>
                            <td class="px-6 py-4 text-right text-gray-900">@Model.StockBalances.Sum(s => s.QuantityAvailable).ToString("N2")</td>
                            <td class="px-6 py-4 text-right text-gray-900">-</td>
                            <td class="px-6 py-4 text-right text-gray-900">@Model.StockBalances.Sum(s => s.TotalValue).ToString("N2")</td>
                            <td class="px-6 py-4"></td>
                        </tr>
                    }
                    else
                    {
                        <tr>
                            <td colspan="9" class="px-6 py-12 text-center">
                                <div class="flex flex-col items-center">
                                    <i class="bi bi-inbox text-5xl text-gray-300 mb-3"></i>
                                    <p class="text-gray-500 text-lg">No stock data found</p>
                                    <p class="text-sm text-gray-400 mt-2">Try adjusting your filters or add new inventory transactions</p>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Summary Cards -->
@if (Model.StockBalances.Any())
{
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mt-6">
        <div class="bg-white rounded-lg shadow-sm p-6">
            <div class="flex items-center">
                <div class="flex-shrink-0 bg-blue-500 rounded-md p-3">
                    <i class="bi bi-boxes text-white text-2xl"></i>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">Total Items</p>
                    <p class="text-2xl font-bold text-gray-900">@Model.StockBalances.Count</p>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-sm p-6">
            <div class="flex items-center">
                <div class="flex-shrink-0 bg-green-500 rounded-md p-3">
                    <i class="bi bi-check-circle text-white text-2xl"></i>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">In Stock</p>
                    <p class="text-2xl font-bold text-gray-900">@Model.StockBalances.Count(s => s.QuantityOnHand > 0)</p>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-sm p-6">
            <div class="flex items-center">
                <div class="flex-shrink-0 bg-red-500 rounded-md p-3">
                    <i class="bi bi-exclamation-circle text-white text-2xl"></i>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">Out of Stock</p>
                    <p class="text-2xl font-bold text-gray-900">@Model.StockBalances.Count(s => s.QuantityOnHand <= 0)</p>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-sm p-6">
            <div class="flex items-center">
                <div class="flex-shrink-0 bg-purple-500 rounded-md p-3">
                    <i class="bi bi-currency-dollar text-white text-2xl"></i>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">Total Value</p>
                    <p class="text-2xl font-bold text-gray-900">@Model.StockBalances.Sum(s => s.TotalValue).ToString("N2")</p>
                </div>
            </div>
        </div>
    </div>
}
