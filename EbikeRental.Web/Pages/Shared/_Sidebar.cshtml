@using EbikeRental.Shared.Navigation
@using EbikeRental.Shared.Constants

<div class="flex flex-col flex-shrink-0 bg-gradient-to-b from-slate-900 via-slate-800 to-slate-900 w-72 min-h-screen shadow-2xl border-r border-slate-700">
    <!-- Logo & Brand -->
    <a href="/Dashboard" class="flex items-center px-6 py-6 text-white no-underline border-b border-slate-700 hover:bg-slate-800/50 transition-all duration-300 group">
        <div class="w-12 h-12 bg-gradient-to-br from-cyan-400 to-blue-600 rounded-xl flex items-center justify-center mr-3 shadow-lg group-hover:scale-110 transition-transform duration-300">
            <i class="bi bi-lightning-charge-fill text-white text-2xl"></i>
        </div>
        <div class="flex-1">
            <div class="text-lg font-black bg-gradient-to-r from-cyan-400 to-blue-400 text-transparent bg-clip-text">EV Motorcycle</div>
            <div class="text-xs text-cyan-400 font-semibold">ERP System</div>
        </div>
    </a>
    
    <!-- Navigation Menu -->
    <div class="flex-1 overflow-y-auto px-3 py-2 scrollbar-thin scrollbar-thumb-slate-700 scrollbar-track-slate-900">
        <ul class="space-y-0.5" id="mainMenu">
            @foreach (var item in MenuDefinition.GetMenuItems())
            {
                if (item.Roles == null || item.Roles.Any(r => User.IsInRole(r)))
                {
                    if (item.SubItems != null && item.SubItems.Any())
                    {
                        <!-- Menu with Submenu -->
                        <li class="mb-0.5">
                            <button class="flex items-center justify-between w-full text-left text-white px-3 py-2 rounded-lg hover:bg-slate-800/50 transition-all duration-200 menu-toggle group" 
                                    data-target="submenu-@item.Name.Replace(" ", "")" 
                                    type="button">
                                <span class="flex items-center flex-1">
                                    <i class="bi @item.Icon text-base mr-2.5 text-cyan-400 group-hover:text-cyan-300 transition"></i>
                                    <span class="font-semibold text-sm">@item.Name</span>
                                </span>
                                <svg class="w-3.5 h-3.5 transition-transform duration-300 chevron text-cyan-400" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                                </svg>
                            </button>
                            <div class="submenu-wrapper overflow-hidden transition-all duration-300 ease-in-out max-h-0" id="submenu-@item.Name.Replace(" ", "")">
                                <ul class="ml-2.5 mt-0.5 space-y-0.5 py-1 pl-5 border-l-2 border-slate-700">
                                    @foreach (var subItem in item.SubItems)
                                    {
                                        <li>
                                            <a href="@subItem.Url" 
                                               class="flex items-center text-gray-300 hover:text-white px-2.5 py-1.5 rounded-lg hover:bg-slate-800/50 transition-all duration-200 text-xs group">
                                                <i class="bi bi-chevron-right text-xs mr-1.5 text-cyan-500 group-hover:text-cyan-400"></i>
                                                <span>@subItem.Name</span>
                                            </a>
                                        </li>
                                    }
                                </ul>
                            </div>
                        </li>
                    }
                    else
                    {
                        <!-- Single Menu Item -->
                        <li>
                            <a href="@item.Url" 
                               class="flex items-center text-white px-3 py-2 rounded-lg hover:bg-slate-800/50 transition-all duration-200 group">
                                <i class="bi @item.Icon text-base mr-2.5 text-cyan-400 group-hover:text-cyan-300 transition"></i>
                                <span class="font-semibold text-sm">@item.Name</span>
                            </a>
                        </li>
                    }
                }
            }
        </ul>
        
        <!-- Divider -->
        <hr class="border-slate-700 my-3">
        
        <!-- Settings & Tools -->
        <div class="px-3 py-1.5 text-xs font-bold text-cyan-400 uppercase tracking-wider">
            Settings & Tools
        </div>
        <ul class="space-y-0.5 mt-1">
            <li>
                <a href="#" class="flex items-center text-white px-3 py-2 rounded-lg hover:bg-slate-800/50 transition-all duration-200 group">
                    <i class="bi bi-gear-fill text-base mr-2.5 text-cyan-400 group-hover:text-cyan-300 transition"></i>
                    <span class="font-semibold text-sm">Settings</span>
                </a>
            </li>
            <li>
                <a href="#" class="flex items-center text-white px-3 py-2 rounded-lg hover:bg-slate-800/50 transition-all duration-200 group">
                    <i class="bi bi-download text-base mr-2.5 text-cyan-400 group-hover:text-cyan-300 transition"></i>
                    <span class="font-semibold text-sm">Export Data</span>
                </a>
            </li>
        </ul>
    </div>
    
    
    
    <!-- System Status (Mock) -->
    <div class="px-4 py-3 border-t border-slate-700 bg-slate-900/50">
        <div class="bg-slate-800/50 rounded-xl p-3 border border-slate-700">
            <div class="flex items-center justify-between mb-2">
                <span class="text-xs font-bold text-cyan-400">System Status</span>
                <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-bold bg-green-900/50 text-green-400 border border-green-700">
                    <span class="w-1.5 h-1.5 bg-green-400 rounded-full mr-1 animate-pulse"></span>
                    Online
                </span>
            </div>
            <div class="space-y-1.5">
                <div class="flex items-center justify-between text-xs">
                    <span class="text-gray-400 font-medium">Database</span>
                    <span class="text-green-400 font-bold flex items-center gap-1">
                        <i class="bi bi-check-circle-fill text-xs"></i>
                        Connected
                    </span>
                </div>
                <div class="flex items-center justify-between text-xs">
                    <span class="text-gray-400 font-medium">Storage</span>
                    <span class="text-cyan-400 font-bold">45% Used</span>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    /* Submenu animation */
    .submenu-wrapper {
        max-height: 0;
        opacity: 0;
        overflow: hidden;
    }
    .submenu-wrapper.expanded {
        max-height: 1000px;
        opacity: 1;
    }
    
    /* Active menu item */
    .menu-item-active {
        background: rgba(6, 182, 212, 0.1) !important;
        border-left: 3px solid #06b6d4;
    }
    
    /* Custom scrollbar */
    .scrollbar-thin::-webkit-scrollbar {
        width: 6px;
    }
    
    .scrollbar-thin::-webkit-scrollbar-track {
        background: rgb(15 23 42);
    }
    
    .scrollbar-thin::-webkit-scrollbar-thumb {
        background: rgb(51 65 85);
        border-radius: 3px;
    }
    
    .scrollbar-thin::-webkit-scrollbar-thumb:hover {
        background: rgb(71 85 105);
    }
</style>

<script>
    console.log('Sidebar script loaded');
    
    document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM loaded - initializing sidebar');
        
        // Get current page URL
        const currentPath = window.location.pathname;
        console.log('Current path:', currentPath);
        
        // Menu toggle functionality with smooth slide animation
        const menuToggles = document.querySelectorAll('.menu-toggle');
        console.log('Found menu toggles:', menuToggles.length);
        
        menuToggles.forEach((toggle, index) => {
            console.log(`Setting up toggle ${index}:`, toggle.getAttribute('data-target'));
            
            toggle.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                const targetId = this.getAttribute('data-target');
                const submenu = document.getElementById(targetId);
                const chevron = this.querySelector('.chevron');
                
                console.log('Clicked toggle:', targetId, 'Submenu found:', !!submenu);
                
                if (!submenu) {
                    console.error('Submenu not found:', targetId);
                    return;
                }
                
                // Close other submenus
                document.querySelectorAll('.submenu-wrapper').forEach(menu => {
                    if (menu.id !== targetId && menu.classList.contains('expanded')) {
                        menu.classList.remove('expanded');
                        const otherChevron = document.querySelector(`[data-target="${menu.id}"] .chevron`);
                        if (otherChevron) {
                            otherChevron.style.transform = 'rotate(0deg)';
                        }
                    }
                });
                
                // Toggle current submenu
                const isExpanded = submenu.classList.contains('expanded');
                console.log('Current state - expanded:', isExpanded);
                
                if (isExpanded) {
                    submenu.classList.remove('expanded');
                    chevron.style.transform = 'rotate(0deg)';
                    console.log('Closed submenu:', targetId);
                } else {
                    submenu.classList.add('expanded');
                    chevron.style.transform = 'rotate(180deg)';
                    console.log('Opened submenu:', targetId);
                }
            });
        });

        // Auto-expand submenu based on current URL and highlight active menu item
        document.querySelectorAll('#mainMenu a').forEach(link => {
            const linkHref = link.getAttribute('href');
            
            // Highlight active menu item
            if (linkHref === currentPath) {
                link.classList.add('menu-item-active');
                console.log('Active link found:', linkHref);
                
                // Find parent submenu and expand it
                const parentSubmenu = link.closest('.submenu-wrapper');
                if (parentSubmenu) {
                    const submenuId = parentSubmenu.id;
                    const parentToggle = document.querySelector(`[data-target="${submenuId}"]`);
                    const chevron = parentToggle?.querySelector('.chevron');
                    
                    // Expand parent submenu
                    parentSubmenu.classList.add('expanded');
                    if (chevron) {
                        chevron.style.transform = 'rotate(180deg)';
                    }
                    
                    console.log('Auto-expanded submenu:', submenuId);
                }
            }
        });
        
        console.log('Sidebar initialization complete');
    });
</script>
