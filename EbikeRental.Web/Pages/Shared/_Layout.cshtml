<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - ERP Management System</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    
    <!-- Tailwind CSS via Play CDN -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            800: '#1e40af',
                            900: '#1e3a8a',
                        },
                    },
                },
            },
        }
    </script>
    
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    
    <style>
        /* Reset all margins and paddings */
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
        }
        
        /* Smooth animations */
        * {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 font-sans antialiased m-0 p-0 h-full">
<div class="flex min-h-full h-full m-0 p-0">
    @if (User.Identity?.IsAuthenticated ?? false)
    {
        <!-- Sidebar -->
        <div class="w-72 flex-shrink-0 fixed h-full top-0 left-0 z-30">
            <partial name="_Sidebar" />
        </div>
            
        <!-- Main Content Area (with left margin to account for fixed sidebar) -->
        <div class="flex-1 flex flex-col min-w-0 ml-72 h-full">
            <!-- Top Navigation Bar -->
            <header class="bg-white border-b border-gray-200 px-6 py-3 z-20 shadow-sm">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <h5 class="text-xl font-semibold text-gray-800">@ViewData["Title"]</h5>
                        @if (ViewData["Subtitle"] != null)
                        {
                            <span class="text-sm text-gray-500">— @ViewData["Subtitle"]</span>
                        }
                    </div>
                        
                        <!-- Top Bar Actions -->
                        <div class="flex items-center gap-3">
                            <!-- Search Bar -->
                            <div class="relative hidden md:block">
                                <input type="search" 
                                       placeholder="Search..." 
                                       class="w-64 pl-10 pr-4 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <i class="bi bi-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            </div>
                            
                            <!-- Notifications -->
                            <div class="relative">
                                <button type="button" 
                                        class="relative p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition"
                                        id="notificationBtn">
                                    <i class="bi bi-bell text-xl"></i>
                                    <span class="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"></span>
                                </button>
                                <!-- Notification Dropdown (Hidden by default) -->
                                <div id="notificationDropdown" 
                                     class="hidden absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-xl border border-gray-200 overflow-hidden z-50">
                                    <div class="px-4 py-3 border-b border-gray-200 bg-gray-50">
                                        <h6 class="font-semibold text-gray-800">Notifications</h6>
                                    </div>
                                    <div class="max-h-96 overflow-y-auto">
                                        <a href="#" class="block px-4 py-3 hover:bg-gray-50 border-b border-gray-100">
                                            <div class="flex items-start gap-3">
                                                <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                                    <i class="bi bi-check-circle text-blue-600"></i>
                                                </div>
                                                <div class="flex-1 min-w-0">
                                                    <p class="text-sm font-medium text-gray-900">PO-2026-0002 Completed</p>
                                                    <p class="text-xs text-gray-500 mt-1">Production order finished successfully</p>
                                                    <p class="text-xs text-gray-400 mt-1">5 minutes ago</p>
                                                </div>
                                            </div>
                                        </a>
                                        <a href="#" class="block px-4 py-3 hover:bg-gray-50 border-b border-gray-100">
                                            <div class="flex items-start gap-3">
                                                <div class="w-10 h-10 bg-yellow-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                                    <i class="bi bi-exclamation-triangle text-yellow-600"></i>
                                                </div>
                                                <div class="flex-1 min-w-0">
                                                    <p class="text-sm font-medium text-gray-900">Low Stock Alert</p>
                                                    <p class="text-xs text-gray-500 mt-1">Battery Cells (BAT-001) below minimum</p>
                                                    <p class="text-xs text-gray-400 mt-1">1 hour ago</p>
                                                </div>
                                            </div>
                                        </a>
                                        <a href="#" class="block px-4 py-3 hover:bg-gray-50">
                                            <div class="flex items-start gap-3">
                                                <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                                    <i class="bi bi-cart-check text-green-600"></i>
                                                </div>
                                                <div class="flex-1 min-w-0">
                                                    <p class="text-sm font-medium text-gray-900">PR-001 Approved</p>
                                                    <p class="text-xs text-gray-500 mt-1">Purchase request has been approved</p>
                                                    <p class="text-xs text-gray-400 mt-1">2 hours ago</p>
                                                </div>
                                            </div>
                                        </a>
                                    </div>
                                    <div class="px-4 py-3 border-t border-gray-200 bg-gray-50 text-center">
                                        <a href="#" class="text-sm text-blue-600 hover:text-blue-800 font-medium">View all notifications</a>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Quick Actions -->
                            <button type="button" 
                                    class="p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition"
                                    id="quickActionsBtn"
                                    title="Quick Actions">
                                <i class="bi bi-grid-3x3 text-xl"></i>
                            </button>
                            
                            <!-- User Menu -->
                            <div class="relative">
                                <button type="button" 
                                        class="flex items-center gap-2 p-1.5 pr-3 text-gray-700 hover:bg-gray-100 rounded-lg transition"
                                        id="userMenuBtn">
                                    <div class="relative">
                                        <img src="https://ui-avatars.com/api/?name=@(User.Identity?.Name ?? "User")&background=3b82f6&color=fff&size=32&bold=true" 
                                             alt="@User.Identity?.Name" 
                                             class="w-8 h-8 rounded-lg shadow-sm">
                                        <span class="absolute bottom-0 right-0 w-2.5 h-2.5 bg-green-500 border-2 border-white rounded-full"></span>
                                    </div>
                                    <div class="hidden md:block text-left">
                                        <div class="text-sm font-semibold text-gray-900 leading-tight">@User.Identity?.Name</div>
                                        <div class="text-xs text-gray-500 leading-tight">Administrator</div>
                                    </div>
                                    <i class="bi bi-chevron-down text-sm text-gray-500 ml-1"></i>
                                </button>
                                
                                <!-- User Dropdown Menu -->
                                <div id="userMenuDropdown" 
                                     class="hidden absolute right-0 mt-2 w-72 bg-white rounded-lg shadow-xl border border-gray-200 overflow-hidden z-50">
                                    <!-- User Info Header -->
                                    <div class="px-4 py-4 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50">
                                        <div class="flex items-center gap-3">
                                            <div class="relative">
                                                <img src="https://ui-avatars.com/api/?name=@(User.Identity?.Name ?? "User")&background=3b82f6&color=fff&size=48&bold=true" 
                                                     alt="@User.Identity?.Name" 
                                                     class="w-12 h-12 rounded-lg shadow-md">
                                                <span class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-white rounded-full"></span>
                                            </div>
                                            <div class="flex-1 min-w-0">
                                                <div class="text-sm font-semibold text-gray-900 truncate">@User.Identity?.Name</div>
                                                <div class="text-xs text-gray-600 truncate">@User.Identity?.Name@@company.com</div>
                                                <div class="mt-1">
                                                    <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                                        <i class="bi bi-shield-check text-xs mr-1"></i>
                                                        Administrator
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- User Stats (Mock) -->
                                    <div class="px-4 py-3 border-b border-gray-200 bg-gray-50">
                                        <div class="grid grid-cols-3 gap-2 text-center">
                                            <div>
                                                <div class="text-lg font-bold text-gray-900">8</div>
                                                <div class="text-xs text-gray-500">Tasks</div>
                                            </div>
                                            <div>
                                                <div class="text-lg font-bold text-gray-900">15</div>
                                                <div class="text-xs text-gray-500">Orders</div>
                                            </div>
                                            <div>
                                                <div class="text-lg font-bold text-gray-900">3</div>
                                                <div class="text-xs text-gray-500">Alerts</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Menu Items -->
                                    <div class="py-2">
                                        <a href="#" class="flex items-center px-4 py-2.5 text-sm text-gray-700 hover:bg-gray-50 transition">
                                            <i class="bi bi-person-circle text-lg mr-3 text-gray-400"></i>
                                            <span class="flex-1">My Profile</span>
                                            <i class="bi bi-chevron-right text-xs text-gray-400"></i>
                                        </a>
                                        <a href="#" class="flex items-center px-4 py-2.5 text-sm text-gray-700 hover:bg-gray-50 transition">
                                            <i class="bi bi-gear text-lg mr-3 text-gray-400"></i>
                                            <span class="flex-1">Account Settings</span>
                                            <i class="bi bi-chevron-right text-xs text-gray-400"></i>
                                        </a>
                                        <a href="#" class="flex items-center px-4 py-2.5 text-sm text-gray-700 hover:bg-gray-50 transition">
                                            <i class="bi bi-bell text-lg mr-3 text-gray-400"></i>
                                            <span class="flex-1">Notifications</span>
                                            <span class="inline-flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-red-500 rounded-full">3</span>
                                        </a>
                                        <a href="#" class="flex items-center px-4 py-2.5 text-sm text-gray-700 hover:bg-gray-50 transition">
                                            <i class="bi bi-clock-history text-lg mr-3 text-gray-400"></i>
                                            <span class="flex-1">Activity Log</span>
                                        </a>
                                    </div>
                                    
                                    <!-- Additional Info -->
                                    <div class="px-4 py-3 border-t border-gray-200 bg-gray-50">
                                        <div class="flex items-center justify-between text-xs text-gray-500 mb-2">
                                            <span>Last Login:</span>
                                            <span class="font-medium text-gray-700">@DateTime.Now.ToString("dd MMM yyyy HH:mm")</span>
                                        </div>
                                        <div class="flex items-center justify-between text-xs text-gray-500">
                                            <span>Session:</span>
                                            <span class="inline-flex items-center">
                                                <span class="w-1.5 h-1.5 bg-green-500 rounded-full mr-1.5"></span>
                                                <span class="font-medium text-gray-700">Active</span>
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <!-- Logout -->
                                    <div class="border-t border-gray-200">
                                        <a href="/Auth/Logout" class="flex items-center px-4 py-3 text-sm text-red-600 hover:bg-red-50 transition font-medium">
                                            <i class="bi bi-box-arrow-right text-lg mr-3"></i>
                                            <span>Sign Out</span>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </header>

                <!-- Main Content -->
                <main class="flex-1 p-6 overflow-auto">
                    <!-- Breadcrumb (Optional) -->
                    @if (ViewData["Breadcrumbs"] != null)
                    {
                        <nav class="mb-4">
                            <ol class="flex items-center space-x-2 text-sm text-gray-600">
                                @Html.Raw(ViewData["Breadcrumbs"])
                            </ol>
                        </nav>
                    }
                    
                    @RenderBody()
                </main>

                <!-- Footer -->
                <footer class="bg-white border-t border-gray-200 py-4 px-6">
                    <div class="flex items-center justify-between text-sm text-gray-600">
                        <div>
                            &copy; 2025 <strong>ERP Management System</strong> - All rights reserved
                        </div>
                        <div class="flex items-center gap-4">
                            <a asp-page="/Privacy" class="text-blue-600 hover:text-blue-800 transition">Privacy</a>
                            <span class="text-gray-400">•</span>
                            <a href="#" class="text-blue-600 hover:text-blue-800 transition">Terms</a>
                            <span class="text-gray-400">•</span>
                            <a href="#" class="text-blue-600 hover:text-blue-800 transition">Support</a>
                            <span class="text-gray-400">•</span>
                            <span class="text-gray-500">Version 1.0.0</span>
                        </div>
                    </div>
                </footer>
            </div>
        }
        else
        {
            <!-- Non-authenticated layout -->
            <div class="flex-1 flex flex-col min-w-0">
                <main class="flex-1">
                    @RenderBody()
                </main>
            </div>
        }
    </div>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    
    <!-- Dropdown Toggle Scripts -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Notification Dropdown
            const notificationBtn = document.getElementById('notificationBtn');
            const notificationDropdown = document.getElementById('notificationDropdown');
            
            if (notificationBtn && notificationDropdown) {
                notificationBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    // Close other dropdowns
                    const userMenuDropdown = document.getElementById('userMenuDropdown');
                    if (userMenuDropdown) userMenuDropdown.classList.add('hidden');
                    // Toggle notification dropdown
                    notificationDropdown.classList.toggle('hidden');
                });
            }
            
            // User Menu Dropdown
            const userMenuBtn = document.getElementById('userMenuBtn');
            const userMenuDropdown = document.getElementById('userMenuDropdown');
            
            if (userMenuBtn && userMenuDropdown) {
                userMenuBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    // Close other dropdowns
                    if (notificationDropdown) notificationDropdown.classList.add('hidden');
                    // Toggle user menu dropdown
                    userMenuDropdown.classList.toggle('hidden');
                });
            }
            
            // Close all dropdowns when clicking outside
            document.addEventListener('click', function(e) {
                const clickedElement = e.target;
                const isNotificationArea = notificationBtn?.contains(clickedElement) || notificationDropdown?.contains(clickedElement);
                const isUserMenuArea = userMenuBtn?.contains(clickedElement) || userMenuDropdown?.contains(clickedElement);
                
                if (!isNotificationArea && notificationDropdown) {
                    notificationDropdown.classList.add('hidden');
                }
                
                if (!isUserMenuArea && userMenuDropdown) {
                    userMenuDropdown.classList.add('hidden');
                }
            });
            
            // Close dropdowns on ESC key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    if (notificationDropdown) notificationDropdown.classList.add('hidden');
                    if (userMenuDropdown) userMenuDropdown.classList.add('hidden');
                }
            });
        });
    </script>

    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>

