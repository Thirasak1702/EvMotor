# ?? ?????????? PR, PO, GR ???????????????????????????????

## ?????????? (3 ?????)

### ? ???????? 1: PR Items ????? Database (????? Header)
**??????:** ???? Info.cshtml ??? `name="..."` ??????????? `asp-for="..."` ???????? bind ??? model property

### ? ???????? 2: PR Header Department ??? Requestor ????? Database  
**??????:** ???????????????????? 1 - ?????? bind ??? model

### ? ???????? 3: ???? List PR ?????? Data ??? Database
**??????:** 
- ??? `IPurchasingService` ??? service ??????????????
- ??? `PurchaseDto` ??? DTO ??????????
- Property names ?????? .cshtml ????????? DTO

---

## ????????

### ?? Purchase Requisition (PR)

#### 1. ????? `PR/Info.cshtml` - ??? asp-for ??? name
```razor
<!-- ? ???? -->
<input name="DepartmentName" class="form-control" />
<input name="RequestorName" class="form-control" />
<textarea name="Notes" class="form-control"></textarea>

<!-- ? ???? -->
<input asp-for="PR.DepartmentName" class="form-control" />
<span asp-validation-for="PR.DepartmentName" class="text-danger"></span>

<input asp-for="PR.RequestorName" class="form-control" />
<span asp-validation-for="PR.RequestorName" class="text-danger"></span>

<textarea asp-for="PR.Notes" class="form-control"></textarea>
```

**???????:**
- ? DepartmentName ??? bind ??? `PR.DepartmentName` 
- ? RequestorName ??? bind ??? `PR.RequestorName`
- ? Items ??? bind ????????????????????? (??? `name="PR.Items[0].ItemId"` pattern)
- ? ???????? database ??????

#### 2. ????? `PR/Index.cshtml.cs` - ??? Service ??? DTO ??????????
```csharp
// ? ????
private readonly IPurchasingService _purchasingService;
public List<PurchaseDto> PurchaseRequisitions { get; set; }

// ? ????
private readonly IPurchaseRequisitionService _prService;
public List<PurchaseRequisitionDto> PurchaseRequisitions { get; set; }

// OnGetAsync
var result = await _prService.GetAllAsync();
```

#### 3. ????? `PR/Index.cshtml` - ??? property names ??????????
```razor
<!-- ? ???? -->
<td>@pr.VendorName</td>
<td>-</td>

<!-- ? ???? -->
<td>@pr.DepartmentName</td>
<td>@pr.RequestorName</td>
```

#### 4. ????? Filter ?? `PR/Index.cshtml.cs`
```csharp
// ? ????
pr.VendorName.Contains(Department, ...)

// ? ????
pr.DepartmentName.Contains(Department, ...)
```

---

### ?? Purchase Order (PO)

#### 1. ????? `PO/Info.cshtml` - ??? asp-for
```razor
<!-- ? ???? -->
<input name="VendorName" class="form-control" />
<input name="VendorContact" class="form-control" />
<input name="DeliveryAddress" class="form-control" />
<input name="ExpectedDeliveryDate" type="date" class="form-control" />
<textarea name="Notes" class="form-control"></textarea>

<!-- ? ???? -->
<input asp-for="PO.VendorName" class="form-control" />
<span asp-validation-for="PO.VendorName" class="text-danger"></span>

<input asp-for="PO.VendorContact" class="form-control" />
<input asp-for="PO.DeliveryAddress" class="form-control" />
<input asp-for="PO.ExpectedDeliveryDate" type="date" class="form-control" />
<textarea asp-for="PO.Notes" class="form-control"></textarea>
```

#### 2. ????? `PO/Index.cshtml.cs`
```csharp
// ? ????
private readonly IPurchasingService _purchasingService;
public List<PurchaseDto> PurchaseOrders { get; set; }

// ? ????
private readonly IPurchaseOrderService _poService;
public List<PurchaseOrderDto> PurchaseOrders { get; set; }

// OnGetAsync
var result = await _poService.GetAllAsync();
```

#### 3. ????? `PO/Index.cshtml` - ??? OrderDate ??? Date
```razor
<!-- ? ???? -->
<td>@po.Date.ToString("dd/MM/yyyy")</td>

<!-- ? ???? -->
<td>@po.OrderDate.ToString("dd/MM/yyyy")</td>
```

#### 4. ????? Filter ?? `PO/Index.cshtml.cs`
```csharp
// ? ????
po.Date >= FromDate.Value

// ? ????
po.OrderDate >= FromDate.Value
```

---

### ?? Goods Receipt (GR)

#### 1. ????? `GR/Info.cshtml` - ??? asp-for
```razor
<!-- ? ???? -->
<input name="ReceiptDate" type="date" class="form-control" />
<select name="PurchaseOrderId" class="form-select">...</select>
<input name="VendorName" class="form-control" />
<input name="ReceivedBy" class="form-control" />
<select name="WarehouseId" class="form-select">...</select>
<input name="Notes" class="form-control" />

<!-- ? ???? -->
<input asp-for="GR.ReceiptDate" type="date" class="form-control" />
<span asp-validation-for="GR.ReceiptDate" class="text-danger"></span>

<select asp-for="GR.PurchaseOrderId" class="form-select">...</select>

<input asp-for="GR.VendorName" class="form-control" />
<span asp-validation-for="GR.VendorName" class="text-danger"></span>

<input asp-for="GR.ReceivedBy" class="form-control" />
<span asp-validation-for="GR.ReceivedBy" class="text-danger"></span>

<select asp-for="GR.WarehouseId" class="form-select">...</select>
<span asp-validation-for="GR.WarehouseId" class="text-danger"></span>

<input asp-for="GR.Notes" class="form-control" />
```

#### 2. ????? `GR/Index.cshtml.cs`
```csharp
// ? ????
private readonly IPurchasingService _purchasingService;
public List<PurchaseDto> GoodsReceipts { get; set; }

// ? ????
private readonly IGoodsReceiptService _grService;
public List<GoodsReceiptDto> GoodsReceipts { get; set; }

// OnGetAsync
var result = await _grService.GetAllAsync();
```

#### 3. ????? `GR/Index.cshtml`
```razor
<!-- ? ???? -->
<td>@gr.Date.ToString("dd/MM/yyyy")</td>
<td>-</td>

<!-- ? ???? -->
<td>@gr.ReceiptDate.ToString("dd/MM/yyyy")</td>
<td>@gr.PurchaseOrderNumber</td>
```

#### 4. ????? Filter ?? `GR/Index.cshtml.cs`
```csharp
// ? ????
gr.Date >= FromDate.Value
gr.DocumentNumber.Contains(PONumber, ...)

// ? ????
gr.ReceiptDate >= FromDate.Value
gr.PurchaseOrderNumber.Contains(PONumber, ...)
```

---

## ????????????????

### Purchase Requisition (PR)
1. ? `EbikeRental.Web/Pages/Purchasing/PR/Info.cshtml` - Model binding
2. ? `EbikeRental.Web/Pages/Purchasing/PR/Index.cshtml.cs` - Service ??? DTO
3. ? `EbikeRental.Web/Pages/Purchasing/PR/Index.cshtml` - Property names

### Purchase Order (PO)
4. ? `EbikeRental.Web/Pages/Purchasing/PO/Info.cshtml` - Model binding
5. ? `EbikeRental.Web/Pages/Purchasing/PO/Index.cshtml.cs` - Service ??? DTO
6. ? `EbikeRental.Web/Pages/Purchasing/PO/Index.cshtml` - Property names

### Goods Receipt (GR)
7. ? `EbikeRental.Web/Pages/Purchasing/GR/Info.cshtml` - Model binding
8. ? `EbikeRental.Web/Pages/Purchasing/GR/Index.cshtml.cs` - Service ??? DTO
9. ? `EbikeRental.Web/Pages/Purchasing/GR/Index.cshtml` - Property names

---

## ?????????????????? name ??? asp-for

### ? ??? name (???)
```razor
<input name="DepartmentName" class="form-control" />
```
**?????:**
- ??? bind ??? model property ????????????
- ????? validation
- ??? populate ???????????? edit
- ???? manual mapping ?? PageModel

### ? ??? asp-for (???)
```razor
<input asp-for="PR.DepartmentName" class="form-control" />
<span asp-validation-for="PR.DepartmentName" class="text-danger"></span>
```
**????????:**
- Auto bind ??? `PR.DepartmentName` property
- Generate `name` ??? `id` attributes ????????????????
- Client-side ??? server-side validation
- Auto populate ???????????? edit
- Two-way data binding

---

## ????????

### ? Test Create PR
1. ???????? `/Purchasing/PR/Info`
2. ???? Department Name, Requestor Name
3. Add items
4. Save
5. **???????:** 
   - ? DepartmentName ??? RequestorName ???????? database
   - ? Items ??????????????? PurchaseRequisitionItems table

### ? Test Edit PR
1. ???????? `/Purchasing/PR/Info?id=1`
2. **???????:**
   - ? ???? Department Name ??? Requestor Name
   - ? ???? Items ????????????
3. ???????????
4. Save
5. **???????:** ? ???????? database ??????

### ? Test List PR
1. ???????? `/Purchasing/PR`
2. **???????:**
   - ? ?????????? PR ?????????? database
   - ? ???? Department Name ??? Requestor Name
   - ? Filter ????????????

### ? Test PO ??? GR
??????????????????? PR:
- ? Create/Edit ???????????????????
- ? List ????????????? database
- ? Property names ???????

---

## Build Status
? **Build ??????**  
? **????? compilation errors**  
? **??????????** (???? Stop ??? Run ???????????? Hot Reload ?????)

---

## Key Takeaways

### ?? Model Binding Best Practices
1. **??? `asp-for` ????** ?????? input fields ??????? bind ??? model
2. **????? validation** ???? `<span asp-validation-for="...">`
3. **??? tag helpers** ??????????? HTML ??? manual

### ?? Service Pattern
1. **??? service ?????** ????????? generic service
2. **??????? DTO properties** ????????????????????? view
3. **Handle null references** ???? null-conditional operator (`?.`)

### ?? Debugging Tips
1. ?????????? form fields ?? `name` attribute ??????????
2. ??? browser developer tools ?? network request payload
3. ??????? ModelState.IsValid ??? errors
4. ??? breakpoint ??? OnPostAsync ????????????? bind ??

---

**?????:** ? ????????????????????? PR, PO, GR  
**??????:** 2024-12-25  
**????????:** ???? Stop ??? Run app ????
